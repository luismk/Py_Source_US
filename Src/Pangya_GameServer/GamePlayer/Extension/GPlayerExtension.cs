using Pangya_GameServer.Common;
using Pangya_GameServer.ServerTcp;
using PangyaAPI.Helper.BinaryModels;
using PangyaAPI.Helper.Tools;
using PangyaAPI.PangyaClient.Data;
using PangyaAPI.SqlConnector.DataBase;
using System.Linq;
using System.Runtime.CompilerServices;
namespace Pangya_GameServer.GamePlayer
{
    public partial class GPlayer
    {
        #region Set
        public void SetCookie(uint Cookie)
        {
            GetCookie = Cookie;
        }

        public bool SetAuthKey1(string TAUTH_KEY_1)
        {
            GetAuth1 = TAUTH_KEY_1;
            return true;
        }

        public bool SetAuthKey2(string TAUTH_KEY_2)
        {
            GetAuth2 = TAUTH_KEY_2;
            return true;
        }

        public bool SetCapabilities(byte TCapa)
        {
            GetCapability = TCapa;
            if (TCapa == 4)
            {
                Visible = 0;
            }
            return true;
        }

        public void SetExp(uint Amount)
        {
            UserStatistic.EXP = Amount;
        }

        public void SetLevel(byte Amount)
        {
            UserStatistic.Level = Amount;
        }

        public bool SetLogin(string TLogin)
        {
            GetLogin = TLogin;
            return true;
        }

        public bool SetNickname(string TNickname)
        {
            GetNickname = TNickname;
            return true;
        }

        public bool SetSex(byte TSex)
        {
            GetSex = TSex;
            return true;
        }

        public bool SetUID(uint TUID)
        {
            GetUID = TUID;
            return true;
        }
        
        public void SetGameID(ushort ID)
        {
            GameID = ID;
        }
        #endregion


        #region Methods

        [MethodImpl(MethodImplOptions.NoInlining)]
        public void LoadStatistic()
        {
            var packet = new PangyaBinaryReader(MemoryStreamExtension.Memory(new byte[] { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xE0, 0xF5, 0x05, 0x46, 0x6F, 0xDF, 0xD0, 0x39, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, }));
            UserStatistic = packet.Read<PlayerStatistic>();
        }

        [MethodImpl(MethodImplOptions.NoInlining)]
        public void LoadGuildData()
        {
            GuildInfo.Image = string.Empty;
            GuildInfo.Introducing = string.Empty;
            GuildInfo.LeaderNickname = string.Empty;
            GuildInfo.Name = string.Empty;
            GuildInfo.Notice = string.Empty;
            //foreach (var Data in _db.ProcGuildGetPlayerData((int)GetUID, 0))
            //{
            //    GuildInfo = new Common.GuildData
            //    {
            //        Name = Data.GUILD_NAME,
            //        ID = (uint)Data.GUILD_INDEX,
            //        Position = Data.GUILD_POSITION,
            //        Image = Data.GUILD_IMAGE,
            //        Introducing = Data.GUILD_INTRODUCING,
            //        LeaderNickname = Data.GUILD_LEADER_NICKNAME,
            //        Notice = Data.GUILD_NOTICE,
            //        LeaderUID = (uint)Data.GUILD_LEADER_UID,
            //        TotalMember = (uint)Data.GUILD_TOTAL_MEMBER,
            //    };
            //}

            //if (GuildInfo.LeaderUID == 0)
            //{
            //    GuildInfo.LeaderUID = uint.MaxValue;
            //}
        }

        public bool RemoveCookie(uint Amount)
        {
            if (GetCookie < Amount)
            {
                return (false);
            }
            GetCookie -= Amount;
            var table1 = $"UPDATE Pangya_Personal SET CookieAmt = '{GetCookie}' WHERE UID = '{GetUID}'";
            _db.Database.SqlQuery<PangyaEntities>(table1).FirstOrDefault();
            return (true);
        }

        public bool RemoveLockerPang(uint Amount)
        {
            if ((LockerPang < Amount)) return (false);
            LockerPang -= Amount;
            var table1 = $"UPDATE Pangya_Personal SET PangLockerAmt = '{LockerPang}' WHERE UID = '{GetUID}'";
            _db.Database.SqlQuery<PangyaEntities>(table1).FirstOrDefault();
            return (true);
        }

        public bool RemovePang(uint Amount)
        {
            if (UserStatistic.Pang < Amount)
            {
                return (false);
            }
            UserStatistic.Pang -= Amount;
            var table1 = $"UPDATE Pangya_User_Statistics SET Pang = '{UserStatistic.Pang}' WHERE UID = '{GetUID}'";
            _db.Database.SqlQuery<PangyaEntities>(table1).FirstOrDefault();
            return (true);
        }

        public bool AddLockerPang(uint Amount)
        {
            LockerPang += Amount;

            var table1 = $"UPDATE Pangya_Personal SET PangLockerAmt = '{LockerPang}' WHERE UID = '{GetUID}'";
            _db.Database.SqlQuery<PangyaEntities>(table1).FirstOrDefault();
            return (true);
        }

        public bool AddPang(uint Amount)
        {
            if (UserStatistic.Pang >= uint.MaxValue)
            {
                return false;
            }
            UserStatistic.Pang += Amount;
            var table1 = $"UPDATE Pangya_User_Statistics SET Pang = '{UserStatistic.Pang}' WHERE UID = '{GetUID}'";
            _db.Database.SqlQuery<PangyaEntities>(table1).FirstOrDefault();
            return true;
        }

        public bool AddCookie(uint Amount)
        {
            if (GetCookie >= uint.MaxValue)
            {
                return false;
            }
            GetCookie += Amount;
            var table1 = $"UPDATE Pangya_Personal SET CookieAmt = '{GetCookie}' WHERE UID = '{GetUID}'";
            _db.Database.SqlQuery<PangyaEntities>(table1).FirstOrDefault();
            return true;
        }

        public bool InventoryLoad()
        {
            if (GetUID != 0)
            {
                Inventory = new Models.Inventory(GetUID);
                return true;
            }
            else
            {
                return false;
            }
        }

        public byte[] GetGameInfomations(int level)
        {
            using (var result = new PangyaBinaryWriter())
            {
                result.WriteUInt32(ConnectionID);
                if (level >= 1)
                {
                    result.Write(GetGameInfo());
                }
                if (level >= 2)
                {
                    result.Write(Inventory.GetCharData());
                }

                return result.GetBytes();
            }
        }

        /// <summary>
        /// return 239 bytes
        /// </summary>
        /// <returns></returns>
        public byte[] Statistic()
        {
            PangyaBinaryWriter result;
            result = new PangyaBinaryWriter();
            result.WriteStruct(UserStatistic);
            var response = result.GetBytes();
            return response;
        }

        /// <summary>
        /// Size = 267 bytes
        /// </summary>
        /// <returns>login information</returns>
        public byte[] GetLoginInfo()
        {
            PangyaBinaryWriter Reply;
            Reply = new PangyaBinaryWriter();
            try
            {
                Reply.WriteUInt16(GameID);
                Reply.WriteStr(GetLogin, 22);
                Reply.WriteStr(GetNickname, 22);
                Reply.WriteStr(GuildInfo.Name, 17);
                Reply.WriteStr(GuildInfo.Image, 16);
                Reply.WriteUInt64(GetCapability);
                Reply.WriteUInt32(ConnectionID);
                Reply.WriteZero(12);
                Reply.WriteUInt64(GuildInfo.ID);
                Reply.WriteUInt16(GetSex);
                Reply.Write(new byte[] { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF });
                Reply.WriteZero(16);
                Reply.WriteZero(128);
                Reply.WriteUInt32(GetUID);
                return Reply.GetBytes();
            }
            finally
            {
                Reply.Dispose();
            }
        }

        public byte[] GetGameInfo()
        {
            using (var Reply = new PangyaBinaryWriter())
            {
                Reply.WriteStr(GetNickname, 22);
                Reply.WriteStr(GuildInfo.Name, 17);//bytes 39 
                Reply.WriteByte(GameInfo.SlotNumber);//40 bytes
                Reply.WriteUInt32(Visible);//44 bytes
                Reply.WriteUInt32(Inventory.GetTitleTypeID());
                Reply.WriteUInt32(Inventory.GetCharTypeID());//52 bytes                
                Reply.WriteStruct(Inventory.ToolBar.Decoration);//72 bytes              
                Reply.WriteByte((byte)GameInfo.Role);//77 bytes
                Reply.WriteByte(Compare.IfCompare<byte>(GameInfo.ReadyToPlay, 0x02, 0x00));//78 bytes
                Reply.WriteByte(GetLevel); // 79 bytes == GetLevel
                Reply.WriteByte(0); // 80 bytes
                Reply.WriteByte(0x0A);// 81 bytes
                Reply.WriteUInt32(GuildInfo.ID); // 85 bytes
                Reply.WriteStr(Compare.IfCompare(GuildInfo.Image.Length <= 0, "guildmark", GuildInfo.Image), 12);//94 bytes
                Reply.WriteUInt32(GetUID);//101 bytes
                Reply.Write(GameInfo.Action.ToArray());//123 bytes
                Reply.WriteUInt32(0);//ID Shop//127 bytes
                Reply.WriteStr("Shop Name", 35);//158 bytes
                Reply.WriteZero(33);//191 bytes
                Reply.WriteUInt32(Inventory.GetMascotTypeID());//195 bytes
                Reply.WriteByte(Compare.IfCompare<byte>(Inventory.IsExist(436207618), 0x1, 0x0)); // Pang Mastery// 196 bytes
                Reply.WriteByte(Compare.IfCompare<byte>(Inventory.IsExist(436207621), 0x1, 0x0)); // Nitro Pang Mastery//197 bytes
                Reply.WriteStr(GetSubLogin, 18);
                Reply.WriteZero(103);//329 bytes
                Reply.Write(0);//333 bytes = 0x1400006C
                Reply.Write(0);//337 bytes = 0x42000000
                var Getbytes = Reply.GetBytes();
                return Getbytes;
            }
        }
        /// <summary>
        /// Size Packet = 277 
        /// </summary>
        /// <returns></returns>
        public byte[] GetGuildInfo()
        {
            var Reply = new PangyaBinaryWriter();
            Reply.WriteStruct(GuildInfo);
            return Reply.GetBytes();
        }

        public byte[] GetMapStatistic()
        {
            return new byte[] { 0x00, 0x00, 0x00, 0x00, 0x48, 0x00, 0x2E, 0x01, 0x38, 0xB0, 0xAA, 0x0C, 0xC9, 0x9D, 0x82, 0x7C, 0xC8, 0x7F, 0x81, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0xE2, 0x00, 0x78, 0xAD, 0xAA, 0x0C, 0xB4, 0xAF, 0xAA, 0x0C, 0xF8, 0xE6, 0x79, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xC0, 0xAF, 0xAA, 0x0C, 0xAB, 0x85, 0x40, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x2E, 0x8F, 0xAD, 0x2B, 0x50, 0x00, 0x00, 0x00, 0xD8, 0x6B, 0x02, 0x15, 0x00, 0x00, 0x00, 0x00, 0x20, 0xC4, 0xE7, 0x1D, 0xD8, 0x6B, 0xED, 0x15, 0x98, 0xAF, 0xAA, 0x0C, 0xD8, 0x6B, 0xED, 0x15, 0x50, 0x00, 0x00, 0x00, 0xDC, 0xAF, 0xAA, 0x7F, 0x7D, 0xA6, 0x40, 0x00, 0x20, 0xC4, 0xE7, 0x1D, 0x60, 0xC7, 0xE7, 0x1D, 0x50, 0x03, 0x00, 0x00, 0xC8, 0x6B, 0xED, 0x15, 0xA8, 0xD2, 0x8F, 0x00, 0x90, 0xD2, 0x8F, 0x00, 0x0C, 0xB0, 0xAA, 0x0C, 0xE5, 0x4E, 0x5F, 0x00, 0x8C, 0xB0, 0xAA, 0x0C, 0x00, 0x00, 0x7F, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xE2, 0x90, 0xAD, 0x2B, 0xD8, 0x6B, 0xED, 0x15, 0x04, 0x6B, 0xED, 0x15, 0xC8, 0x6B, 0xED, 0x15, 0x40, 0xB0, 0xAA, 0x0C, 0xA8, 0xD2, 0x8F, 0x00, 0x00, 0x00, 0xE2, 0x00, 0x48, 0x00, 0x2E, 0x01, 0x4C, 0xB0, 0xAA, 0x0C, 0x92, 0x7F, 0x5F, 0x00, 0x90, 0xD2, 0x8F, 0x00, 0xA2, 0x90, 0x01, 0x00, 0x68, 0xAF, 0xAA, 0x05, 0x0F, 0x00, 0x00, 0x00, 0xB4, 0xB8, 0xAA, 0x0C, 0xE0, 0x80, 0x82, 0x7C, 0xD0, 0x9D, 0x82, 0x7C, 0xFF, 0xFF, 0xFF, 0xFF, 0xC9, 0x9D, 0x82, 0x7C, 0xBD, 0x19, 0x75, 0x00, 0x7F, 0x00, 0xE2, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0xC7, 0xE7, 0x1D, 0xC0, 0xB8, 0x06, 0x0C, 0xA1, 0x64, 0x5F, 0x00, 0x60, 0xC7, 0xE7, 0x1D, 0x2E, 0x98, 0xAD, 0x2B, 0xDC, 0xD2, 0x8F, 0x00, 0x04, 0x00, 0x00, 0x00, 0xD0, 0x64, 0x5F, 0x00, 0x30, 0xD2, 0x8F, 0x7F, 0x91, 0x82, 0xF2, 0x52, 0x00, 0x00, 0x00, 0x00, 0x84, 0xB0, 0xAA, 0x0C, 0x8C, 0x07, 0xAA, 0x0C, 0x04, 0x00, 0x00, 0x00, 0x48, 0xEB, 0x7D, 0x00, 0x91, 0x82, 0xF2, 0x52, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC7, 0xE7, 0x1D, 0x8A, 0x91, 0x6E, 0x00, 0x5E, 0x90, 0x7F, 0x2B, 0x04, 0xB9, 0xAA, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x08, 0xB8, 0xAA, 0x0C, 0xA8, 0xEB, 0x7D, 0x00, 0x31, 0x09, 0x44, 0x6F, 0x6C, 0x66, 0x69, 0x6E, 0x69, 0x09, 0x30, 0x09, 0x5B, 0x4E, 0x5F, 0x4C, 0x4F, 0x47, 0x49, 0x4E, 0x5D, 0x7F, 0x4C, 0x6F, 0x67, 0x49, 0x6E, 0x50, 0x72, 0x6F, 0x63, 0x65, 0x73, 0x73, 0x20, 0x09, 0x20, 0x43, 0x4F, 0x4D, 0x50, 0x4C, 0x41, 0x54, 0x45, 0x20, 0x3A, 0x20, 0x47, 0x55, 0x49, 0x44, 0x28, 0x31, 0x30, 0x37, 0x29, 0x2C, 0x20, 0x43, 0x6F, 0x75, 0x6E, 0x74, 0x7F, 0x33, 0x32, 0x29, 0x2C, 0x20, 0x43, 0x6D, 0x64, 0x49, 0x44, 0x28, 0x32, 0x31, 0x0A, 0x0A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0B, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0B, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, };
        }

        public byte[] GetLobbyInfo()
        {
            PangyaBinaryWriter Reply;

            Reply = new PangyaBinaryWriter();
            try
            {
                Reply.WriteUInt32(GetUID);
                Reply.WriteUInt32(ConnectionID);
                Reply.WriteUInt16(GameID); // Room Number
                Reply.WriteStr(GetNickname, 22);
                Reply.WriteByte(UserStatistic.Level); // Level
                Reply.WriteUInt32(Visible); // GM
                Reply.WriteUInt32(GetCapability == 4 ? 964689929 : Inventory.GetTitleTypeID());//); // Title TypeID
                Reply.Write(1000); // Unknown
                Reply.WriteByte(GetSex); // Add $10 for wings  + $10 + $20
                Reply.WriteUInt32(GuildInfo.ID); // Guild ID
                Reply.WriteStr(GuildInfo.Image, 12); // Guild Images 9 Length
                Reply.WriteByte(0); // IS VIP ?
                Reply.WriteZero(6);
                Reply.WriteStr(GetSubLogin, 18);
                Reply.WriteZero(109);
                return Reply.GetBytes();
            }
            finally
            {
                Reply.Dispose();
            }
        }

        public void SendExp()
        {
            PangyaBinaryWriter Packet;

            Packet = new PangyaBinaryWriter();
            try
            {
                Packet.Write(new byte[] { 0xD9, 0x01 });
                Packet.WriteUInt32(UserStatistic.Level);
                Packet.WriteUInt32(UserStatistic.EXP);
                Send(Packet.GetBytes());
            }
            finally
            {
                Packet.Dispose();
            }
        }

        public void SendLevelUp()
        {
            PangyaBinaryWriter Packet;

            Packet = new PangyaBinaryWriter();
            try
            {
                Packet.Write(new byte[] { 0x0F, 0x00 });
                Packet.Write(0);
                Packet.Write(this.GetLevel);
                Packet.Write(this.GetLevel);
                SendResponse(Packet);
            }
            finally
            {
                Packet.Dispose();
            }
        }

        public void SendCookies()
        {
            PangyaBinaryWriter Reply;
            Reply = new PangyaBinaryWriter();
            try
            {
                Reply.Write(new byte[] { 0x96, 0x00 });
                Reply.WriteUInt64(GetCookie);
                Send(Reply.GetBytes());
            }
            finally
            {
                Reply.Dispose();
            }
        }

        public void SendGuildData()
        {
            PangyaBinaryWriter Packet;


            Packet = new PangyaBinaryWriter();
            try
            {
                Packet.Write(new byte[] { 0xBF, 0x01 });
                Packet.WriteUInt32(1);
                Packet.WriteUInt32(GuildInfo.ID); // Guild ID
                Packet.WriteStr(GuildInfo.Name, 17);
                Packet.WriteZero(9);
                Packet.WriteUInt32(GuildInfo.TotalMember);
                Packet.WriteStr(GuildInfo.Image, 9);
                Packet.WriteZero(3);
                Packet.WriteStr(GuildInfo.Notice, 0x65);
                Packet.WriteStr(GuildInfo.Introducing, 101);
                Packet.WriteUInt32(GuildInfo.Position);
                Packet.WriteUInt32(GuildInfo.LeaderUID);
                Packet.WriteStr(GuildInfo.LeaderNickname, 22);
                Send(Packet.GetBytes());
            }
            finally
            {
                Packet.Dispose();
            }
        }

        public void SendLockerPang()
        {
            PangyaBinaryWriter Packet;
            Packet = new PangyaBinaryWriter();
            try
            {
                Packet.Write(new byte[] { 0x72, 0x01 });
                Packet.WriteUInt64(LockerPang);
                Send(Packet.GetBytes());
            }
            finally
            {
                Packet.Dispose();
            }
        }

        public void SendPang()
        {
            PangyaBinaryWriter Packet;
            Packet = new PangyaBinaryWriter();
            try
            {
                Packet.Write(new byte[] { 0xC8, 0x00 });
                Packet.WriteUInt64(GetPang);
                Packet.WriteUInt32(0);
                Send(Packet.GetBytes());
            }
            finally
            {
                Packet.Dispose();
            }
        }

        public void SendLoginMainData(string version, ServerOptions serverOptions)
        {
            Response.Clear();
            Response.Write(new byte[] { 0x44, 0x00, 0x00 });
            Response.WritePStr(version);
            Response.WritePStr("PangYa_GameServer");//PangyaServer1.exe
            Response.Write(GetLoginInfo());
            Response.Write(Statistic());
            Response.Write(Inventory.GetTrophyInfo());
            Response.Write(Inventory.GetEquipData());
            Response.WriteZero(10836);
            Response.Write(Inventory.GetEquipInfo());
            Response.WriteTime();           
            Response.WriteStruct(serverOptions.OptionsData.GetInfo());
            Response.Write(GetGuildInfo());
            SendResponse();
        }


        public void SendCharacterData()
        {
            SendResponse(Inventory.ItemCharacter.Build());
        }

        public void SendItemsData()
        {
            SendResponse(Inventory.ItemWarehouse.Build());
        }

        public void SendCaddiesData()
        {
            SendResponse(Inventory.ItemCaddie.Build());
        }

        public void SendMascotsData()
        {
            SendResponse(Inventory.ItemMascot.Build());
        }

        public void SendEquipmentData()
        {
            SendResponse(Inventory.GetToolbar());
        }

        public void SendLobbyList()
        {
            SendResponse(((GameServer)Server).CreateLobbyList());
        }
        #endregion
    }
}
